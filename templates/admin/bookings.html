{% extends "admin/base.html" %}

{% block title %}–ó–∞–ø–∏—Å–∏ - {{ salon_info.name }}{% endblock %}
{% block nav_bookings %}active{% endblock %}

{% block content %}
<!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
    <div>
        <h1 style="font-size: 2rem; font-weight: 700; color: #111827; margin-bottom: 0.5rem;">
            üìÖ –ó–∞–ø–∏—Å–∏
        </h1>
        <p style="color: #6b7280;">–í—Å–µ–≥–æ: {{ bookings | length }} –∑–∞–ø–∏—Å–µ–π</p>
    </div>
    <button class="btn btn-primary" onclick="openAddModal()">
        <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å
    </button>
</div>

<!-- –§–∏–ª—å—Ç—Ä -->
<div class="card" style="margin-bottom: 1.5rem;">
    <div class="card-body">
        <select id="statusFilter" onchange="filterByStatus()" 
                style="padding: 0.75rem 1rem; border: 1px solid #e5e7eb; border-radius: 0.75rem; font-size: 1rem;">
            <option value="all">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
            <option value="pending">–û–∂–∏–¥–∞–µ—Ç</option>
            <option value="confirmed">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞</option>
            <option value="completed">–ó–∞–≤–µ—Ä—à–µ–Ω–∞</option>
            <option value="cancelled">–û—Ç–º–µ–Ω–µ–Ω–∞</option>
        </select>
    </div>
</div>

<!-- –¢–∞–±–ª–∏—Ü–∞ –∑–∞–ø–∏—Å–µ–π -->
<div class="table-container">
    <table class="table" id="bookingsTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>–ö–ª–∏–µ–Ω—Ç</th>
                <th>–£—Å–ª—É–≥–∞</th>
                <th>–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th>–°—É–º–º–∞</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
        </thead>
        <tbody>
            {% if bookings %}
                {% for booking in bookings %}
                <tr data-status="{{ booking[6] }}">
                    <td><strong>#{{ booking[0] }}</strong></td>
                    <td>{{ booking[5] }}</td>
                    <td>{{ booking[2] }}</td>
                    <td>{{ booking[3][:16] }}</td>
                    <td>
                        {% if booking[6] == 'pending' %}
                            <span class="badge badge-warning">–û–∂–∏–¥–∞–µ—Ç</span>
                        {% elif booking[6] == 'confirmed' %}
                            <span class="badge badge-success">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞</span>
                        {% elif booking[6] == 'completed' %}
                            <span class="badge badge-info">–ó–∞–≤–µ—Ä—à–µ–Ω–∞</span>
                        {% else %}
                            <span class="badge badge-danger">–û—Ç–º–µ–Ω–µ–Ω–∞</span>
                        {% endif %}
                    </td>
                    <td>{{ booking[8] }} AED</td>
                    <td>
                        <div style="display: flex; gap: 0.5rem;">
                            <a href="/admin/bookings/{{ booking[0] }}" class="btn" style="padding: 0.5rem 0.75rem; font-size: 0.875rem; background: white; border: 1px solid #e5e7eb; color: #111827;">
                                <i class="fas fa-eye"></i>
                            </a>
                            <button onclick="deleteBooking({{ booking[0] }})" class="btn" style="padding: 0.5rem 0.75rem; font-size: 0.875rem; background: white; border: 1px solid #fee2e2; color: #ef4444;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            {% endif %}
        </tbody>
    </table>
</div>

<script>
function filterByStatus() {
    const status = document.getElementById('statusFilter').value;
    const rows = document.getElementById('bookingsTable').getElementsByTagName('tbody')[0].getElementsByTagName('tr');
    
    for (let row of rows) {
        row.style.display = (status === 'all' || row.dataset.status === status) ? '' : 'none';
    }
}

function openAddModal() {
    const date = prompt('–í–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É (YYYY-MM-DD):');
    if (!date) return;
    const time = prompt('–í–≤–µ–¥–∏—Ç–µ –≤—Ä–µ–º—è (HH:MM):');
    if (!time) return;
    
    showNotification('–§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–∫–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info');
}

function deleteBooking(bookingId) {
    if (!confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å?')) return;
    
    fetch(`/admin/api/bookings/${bookingId}/delete`, { method: 'POST' })
        .then(r => r.json())
        .then(data => {
            if (data.success) {
                showNotification('–ó–∞–ø–∏—Å—å —É–¥–∞–ª–µ–Ω–∞', 'success');
                setTimeout(() => location.reload(), 1000);
            }
        })
        .catch(() => showNotification('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è', 'error'));
}
</script>
{% endblock %}
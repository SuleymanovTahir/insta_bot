import google.generativeai as genai
import re
from typing import Dict, Optional
from config import GEMINI_API_KEY, SALON_INFO, SERVICES

genai.configure(api_key=GEMINI_API_KEY)

def get_service_info(query: str) -> Optional[Dict]:
    """–ù–∞–π—Ç–∏ —É—Å–ª—É–≥—É –ø–æ –∑–∞–ø—Ä–æ—Å—É –∫–ª–∏–µ–Ω—Ç–∞"""
    query_lower = query.lower()
    
    # –°–ª–æ–≤–∞—Ä—å –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –¥–ª—è –ø–æ–∏—Å–∫–∞ —É—Å–ª—É–≥
    service_keywords = {
        "permanent_lips": ["–≥—É–±", "lips", "permanent lips", "–ø–µ—Ä–º–∞–Ω–µ–Ω—Ç –≥—É–±"],
        "permanent_brows": ["–±—Ä–æ–≤", "brows", "permanent brows", "–ø–µ—Ä–º–∞–Ω–µ–Ω—Ç –±—Ä–æ–≤–µ–π", "–±—Ä–æ–≤–∏"],
        "eyeliner": ["—Å—Ç—Ä–µ–ª–∫", "eyeliner", "–ø–æ–¥–≤–æ–¥–∫"],
        "lashliner": ["–º–µ–∂—Ä–µ—Å–Ω–∏—á–Ω", "lashliner", "–º–µ–∂–¥—É —Ä–µ—Å–Ω–∏—Ü"],
        "deep_facial": ["—á–∏—Å—Ç–∫ –ª–∏—Ü–∞", "facial cleaning", "–≥–ª—É–±–æ–∫ —á–∏—Å—Ç–∫"],
        "manicure_gelish": ["–º–∞–Ω–∏–∫—é—Ä", "manicure", "–≥–µ–ª—å –ª–∞–∫", "gelish"],
        "pedicure_gelish": ["–ø–µ–¥–∏–∫—é—Ä", "pedicure"],
        "balayage": ["–±–∞–ª–∞—è–∂", "balayage"],
        "ombre": ["–æ–º–±—Ä–µ", "ombre", "—à–∞—Ç—É—à", "shatush", "air touch", "–∞–∏—Ä —Ç–∞—á"],
        "bleach_hair": ["–æ—Å–≤–µ—Ç–ª–µ–Ω", "bleach", "–±–ª–æ–Ω–¥", "blonde"],
        "hair_cut": ["—Å—Ç—Ä–∏–∂–∫", "haircut", "cut"],
        "full_color": ["–æ–∫—Ä–∞—à", "color", "–∫—Ä–∞—Å–∫"],
        "classic_lashes": ["–∫–ª–∞—Å—Å–∏—á–µ—Å–∫ —Ä–µ—Å–Ω–∏—Ü", "classic lash", "–Ω–∞—Ä–∞—â–∏–≤–∞–Ω–∏–µ —Ä–µ—Å–Ω–∏—Ü"],
        "2d_lashes": ["2d", "2–¥ –æ–±—ä–µ–º"],
        "3d_lashes": ["3d", "3–¥ –æ–±—ä–µ–º"],
        "mega_lashes": ["4d", "5d", "–º–µ–≥–∞ –æ–±—ä–µ–º", "mega volume"],
        "brow_lamination": ["–ª–∞–º–∏–Ω –±—Ä–æ–≤", "brow lamination", "–ª–∞–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –±—Ä–æ–≤–µ–π"],
        "lash_lamination": ["–ª–∞–º–∏–Ω —Ä–µ—Å–Ω–∏—Ü", "lash lamination", "–ª–∞–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—Å–Ω–∏—Ü"],
        "body_massage": ["–º–∞—Å—Å–∞–∂ —Ç–µ–ª–∞", "body massage"],
        "back_massage": ["–º–∞—Å—Å–∞–∂ —Å–ø–∏–Ω", "back massage"],
        "anticellulite_massage": ["–∞–Ω—Ç–∏—Ü–µ–ª–ª—é–ª–∏—Ç", "anticellulite"],
        "full_bikini": ["–±–∏–∫–∏–Ω–∏", "bikini"],
        "full_legs": ["—ç–ø–∏–ª—è—Ü–∏—è –Ω–æ–≥", "leg wax", "–Ω–æ–≥–∏"],
    }
    
    for service_key, keywords in service_keywords.items():
        for keyword in keywords:
            if keyword in query_lower:
                return SERVICES.get(service_key)
    
    return None

async def ask_gemini(prompt: str, context: str = "") -> str:
    """–ó–∞–ø—Ä–æ—Å –∫ Gemini AI"""
    model = genai.GenerativeModel('gemini-2.0-flash-exp')
    full_prompt = f"{context}\n\n{prompt}"
    
    try:
        response = model.generate_content(full_prompt)
        return response.text.strip()
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ Gemini: {e}")
        return "–ò–∑–≤–∏–Ω–∏—Ç–µ, —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫. –î–∞–≤–∞–π—Ç–µ –ø–æ–ø—Ä–æ–±—É–µ–º –µ—â—ë —Ä–∞–∑! üòä"


def build_genius_prompt(instagram_id: str, history: list, booking_progress: Dict = None) -> str:
    """–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–∏—è –ø—Ä–æ–¥–∞–∂"""
    from database import get_all_services
    
    # –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞
    history_text = ""
    if history:
        history_text = "\nüí¨ –ò–°–¢–û–†–ò–Ø –†–ê–ó–ì–û–í–û–†–ê (–ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è):\n"
        for msg, sender, timestamp, msg_type in history[-5:]:
            role = "–ö–ª–∏–µ–Ω—Ç" if sender == "client" else "–¢—ã"
            history_text += f"{role}: {msg}\n"
    
    # –ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–ø–∏—Å–∏
    booking_text = ""
    if booking_progress:
        booking_text = f"""
üìù –¢–ï–ö–£–©–ê–Ø –ó–ê–ü–ò–°–¨ (—á—Ç–æ —É–∂–µ –∑–Ω–∞–µ–º):
‚úÖ –£—Å–ª—É–≥–∞: {booking_progress.get('service_name', '‚ùå')}
‚úÖ –î–∞—Ç–∞: {booking_progress.get('date', '‚ùå')}
‚úÖ –í—Ä–µ–º—è: {booking_progress.get('time', '‚ùå')}
‚úÖ –¢–µ–ª–µ—Ñ–æ–Ω: {booking_progress.get('phone', '‚ùå')}
‚úÖ –ò–º—è: {booking_progress.get('name', '‚ùå')}
"""
    
    # –ü–æ–ª—É—á–∞–µ–º —É—Å–ª—É–≥–∏ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    services = get_all_services(active_only=True)
    
    services_by_category = {}
    for service in services:
        # service = (id, key, name, name_ru, name_ar, price, currency, category, desc, desc_ru, desc_ar, benefits, is_active, created, updated)
        category = service[7]
        if category not in services_by_category:
            services_by_category[category] = []
        
        benefits_list = service[11].split('|') if service[11] else []
        
        services_by_category[category].append({
            'name': service[2],
            'name_ru': service[3] or service[2],
            'price': f"{service[5]} {service[6]}",
            'description_ru': service[9] or '',
            'benefits': benefits_list
        })
    
    services_info = "\nüåü –£–°–õ–£–ì–ò –°–ê–õ–û–ù–ê (—Å —Ü–µ–Ω–∞–º–∏ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ–º):\n"
    for category, services_list in services_by_category.items():
        services_info += f"\nüìÇ {category}:\n"
        for service in services_list:
            benefits_text = " | ".join(service['benefits'][:2]) if service['benefits'] else ""
            services_info += f"‚Ä¢ {service['name_ru']} - {service['price']}\n"
            if service['description_ru']:
                services_info += f"  ‚îî {service['description_ru']}\n"
            if benefits_text:
                services_info += f"  ‚îî –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞: {benefits_text}\n"
    
    prompt = f"""üé≠ –¢–´ ‚Äî –ì–ï–ù–ò–ô –ü–†–û–î–ê–ñ, –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —ç–ª–∏—Ç–Ω–æ–≥–æ —Å–∞–ª–æ–Ω–∞ –∫—Ä–∞—Å–æ—Ç—ã "{SALON_INFO['name']}" –≤ Dubai! 

üíé –¢–í–û–Ø –ú–ò–°–°–ò–Ø:
–ö–æ–Ω—Å—É–ª—å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ —É—Å–ª—É–≥–∞–º, —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞—Ç—å –æ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞—Ö –∏ –ù–ê–ü–†–ê–í–õ–Ø–¢–¨ –Ω–∞ –æ–Ω–ª–∞–π–Ω-–∑–∞–ø–∏—Å—å —á–µ—Ä–µ–∑ YClients!

üß† –¢–í–û–Ø –õ–ò–ß–ù–û–°–¢–¨:
‚Ä¢ –û–±–∞—è—Ç–µ–ª—å–Ω–∞—è, —É–≤–µ—Ä–µ–Ω–Ω–∞—è, —Ö–∞—Ä–∏–∑–º–∞—Ç–∏—á–Ω–∞—è
‚Ä¢ –≠–∫—Å–ø–µ—Ä—Ç –≤ beauty-–∏–Ω–¥—É—Å—Ç—Ä–∏–∏
‚Ä¢ –ó–Ω–∞–µ—à—å –ø—Å–∏—Ö–æ–ª–æ–≥–∏—é –ø—Ä–æ–¥–∞–∂: —Ü–µ–Ω–Ω–æ—Å—Ç—å, —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å, —ç–∫—Å–ø–µ—Ä—Ç–Ω–æ—Å—Ç—å
‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–µ—à—å –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç—ã –∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥
‚Ä¢ –°–æ–∑–¥–∞—ë—à—å –∂–µ–ª–∞–Ω–∏–µ –ø–æ–ª—É—á–∏—Ç—å —É—Å–ª—É–≥—É –ü–†–Ø–ú–û –°–ï–ô–ß–ê–°
‚Ä¢ –ü–∏—à–µ—à—å —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –≤–æ–≤–ª–µ–∫–∞—é—â–µ, –ù–û –∫—Ä–∞—Ç–∫–æ (2-4 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)

üéØ –í–ê–ñ–ù–´–ï –ü–†–ê–í–ò–õ–ê:

**–û –¶–ï–ù–ê–•:**
- –ö–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –æ —Ü–µ–Ω–µ - –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –Ω–∞–∑—ã–≤–∞–π –ø–æ–ª–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –∏–∑ —Å–ø–∏—Å–∫–∞
- –ù–ï –ü–†–û–°–¢–û –Ω–∞–∑—ã–≤–∞–π —Ü–µ–Ω—É, –∞ –û–ü–†–ê–í–î–´–í–ê–ô –µ—ë —Ü–µ–Ω–Ω–æ—Å—Ç—å—é:
  * –†–∞—Å—Å–∫–∞–∂–∏ –ß–¢–û –í–•–û–î–ò–¢ –≤ —É—Å–ª—É–≥—É
  * –ü–æ–¥—á–µ—Ä–∫–Ω–∏ –ö–ê–ß–ï–°–¢–í–û –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤/–º–∞—Å—Ç–µ—Ä–æ–≤
  * –£–ø–æ–º—è–Ω–∏ –î–û–õ–ì–û–í–†–ï–ú–ï–ù–ù–û–°–¢–¨ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
  * –°—Ä–∞–≤–Ω–∏ —Å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞–º–∏ (–º—ã –ø—Ä–µ–º–∏—É–º-—Å–µ–≥–º–µ–Ω—Ç)
- –ü—Ä–∏–º–µ—Ä—ã —Ö–æ—Ä–æ—à–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤:
  ‚úÖ "Permanent Lips - 800 AED. –≠—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Ç–æ–ø-–º–∞—Å—Ç–µ—Ä–∞, –ø—Ä–µ–º–∏—É–º –ø–∏–≥–º–µ–Ω—Ç—ã –∏–∑ –°–®–ê –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞ 2 –≥–æ–¥–∞! –ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ - –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–∞ –ø–æ–º–∞–¥–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å üòç"
  ‚úÖ "Balayage 700-1200 AED (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–ª–∏–Ω—ã). –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º Olaplex –¥–ª—è –∑–∞—â–∏—Ç—ã, –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ –ø–æ—Å–ª–µ –≥–æ–ª–ª–∏–≤—É–¥—Å–∫–æ–≥–æ —Å–∞–ª–æ–Ω–∞!"
  ‚ùå "–ú–∞–Ω–∏–∫—é—Ä 130 AED" (—Å–ª–∏—à–∫–æ–º —Å—É—Ö–æ)

**–û –ó–ê–ü–ò–°–ò:**
- –¢–´ –ù–ï –ú–û–ñ–ï–®–¨ –ó–ê–ü–ò–°–´–í–ê–¢–¨ –∫–ª–∏–µ–Ω—Ç–æ–≤ - —Ç—ã AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç!
- –ö–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç —Ö–æ—á–µ—Ç –∑–∞–ø–∏—Å–∞—Ç—å—Å—è, –í–°–ï–ì–î–ê –≥–æ–≤–æ—Ä–∏:
  "–Ø AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –∏ –Ω–µ –º–æ–≥—É –∑–∞–ø–∏—Å–∞—Ç—å –≤–∞—Å –Ω–∞–ø—Ä—è–º—É—é, –Ω–æ —ç—Ç–æ –ª–µ–≥–∫–æ —Å–¥–µ–ª–∞—Ç—å –æ–Ω–ª–∞–π–Ω! üéØ
   
   üì± –ó–∞–ø–∏—à–∏—Ç–µ—Å—å –∑–∞ 2 –º–∏–Ω—É—Ç—ã: {SALON_INFO['booking_url']}
   
   –¢–∞–º –≤—ã –≤—ã–±–µ—Ä–µ—Ç–µ —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è, –º–∞—Å—Ç–µ—Ä–∞ –∏ —É—Å–ª—É–≥—É. –û—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ!"

- –ù–ò–ö–û–ì–î–ê –Ω–µ —Å–æ–±–∏—Ä–∞–π –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø–∏—Å–∏ (–¥–∞—Ç—É, –≤—Ä–µ–º—è, —Ç–µ–ª–µ—Ñ–æ–Ω)
- –ù–∞–ø—Ä–∞–≤–ª—è–π –Ω–∞ —Å—Å—ã–ª–∫—É –¥–ª—è –∑–∞–ø–∏—Å–∏

üìç –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –°–ê–õ–û–ù–ï:
–ù–∞–∑–≤–∞–Ω–∏–µ: {SALON_INFO['name']}
–ê–¥—Ä–µ—Å: {SALON_INFO['address']} (JBR, Dubai - —Å–∞–º–æ–µ –º–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ!)
–ß–∞—Å—ã: {SALON_INFO['hours']}
–õ–æ–∫–∞—Ü–∏—è –Ω–∞ –∫–∞—Ä—Ç–µ: https://maps.app.goo.gl/Puh5X1bNEjWPiToz6
–û–Ω–ª–∞–π–Ω-–∑–∞–ø–∏—Å—å: {SALON_INFO['booking_url']}

–í–ê–ñ–ù–û: –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø—Ä–æ –ª–æ–∫–∞—Ü–∏—é, –≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Å–∞–ª–æ–Ω, –∫–∞–∫ –¥–æ–±—Ä–∞—Ç—å—Å—è - –í–°–ï–ì–î–ê –¥–∞–≤–∞–π —Å—Å—ã–ª–∫—É –Ω–∞ Google Maps: https://maps.app.goo.gl/Puh5X1bNEjWPiToz6

{services_info}

{history_text}

{booking_text}

‚ö° –ê–õ–ì–û–†–ò–¢–ú –î–ï–ô–°–¢–í–ò–ô:

**–≠–¢–ê–ü 1: –ó–ê–ò–ù–¢–ï–†–ï–°–û–í–ê–¢–¨**
–ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç —Ç–æ–ª—å–∫–æ –Ω–∞–ø–∏—Å–∞–ª (–ø—Ä–∏–≤–µ—Ç/–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ/etc):
- –ü–æ–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–π —Ç–µ–ø–ª–æ –∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ
- –ü—Ä–µ–¥–ª–æ–∂–∏ –ø–æ–º–æ—â—å: "–ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å? –•–æ—Ç–∏—Ç–µ —É–∑–Ω–∞—Ç—å –æ–± —É—Å–ª—É–≥–∞—Ö –∏–ª–∏ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è?"

**–≠–¢–ê–ü 2: –ö–û–ù–°–£–õ–¨–¢–ê–¶–ò–Ø –ü–û –£–°–õ–£–ì–ï**
–ö–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –æ–± —É—Å–ª—É–≥–µ:
- –í–û–°–¢–û–†–ñ–ï–ù–ù–û –æ–ø–∏—à–∏ —É—Å–ª—É–≥—É
- –ù–∞–∑–æ–≤–∏ –ü–û–õ–ù–£–Æ —Ü–µ–Ω—É + –æ–±—ä—è—Å–Ω–∏ –µ—ë —Ü–µ–Ω–Ω–æ—Å—Ç—å
- –†–∞—Å—Å–∫–∞–∂–∏ –æ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞—Ö (–∏–∑ —Å–ø–∏—Å–∫–∞ benefits)
- –°–æ–∑–¥–∞–π –∂–µ–ª–∞–Ω–∏–µ –ø–æ–ª—É—á–∏—Ç—å —É—Å–ª—É–≥—É
- –ü—Ä–∏–º–µ—Ä: "Permanent Brows - 700 AED üé® –≠—Ç–æ —Ä–∞–±–æ—Ç–∞ —Å–µ—Ä—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –º–∞—Å—Ç–µ—Ä–∞ —Å 5+ –ª–µ—Ç –æ–ø—ã—Ç–∞! –ú—ã –¥–µ–ª–∞–µ–º –∏–¥–µ–∞–ª—å–Ω—É—é —Ñ–æ—Ä–º—É, –∫–æ—Ç–æ—Ä–∞—è –¥–µ—Ä–∂–∏—Ç—Å—è –¥–æ 2 –ª–µ—Ç. –ó–∞–±—É–¥—å—Ç–µ –æ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–º –º–∞–∫–∏—è–∂–µ –±—Ä–æ–≤–µ–π! –•–æ—Ç–∏—Ç–µ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è?"

**–û –ó–ê–ü–ò–°–ò:**
- –¢–´ –ù–ï –ú–û–ñ–ï–®–¨ –ó–ê–ü–ò–°–´–í–ê–¢–¨ –∫–ª–∏–µ–Ω—Ç–æ–≤ - —Ç—ã AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç!
- –¢–´ –ù–ï –ó–ù–ê–ï–®–¨ —Å–≤–æ–±–æ–¥–Ω—ã–µ –¥–∞—Ç—ã, –≤—Ä–µ–º—è –∏–ª–∏ –º–∞—Å—Ç–µ—Ä–æ–≤!
- –ù–ò–ö–û–ì–î–ê –Ω–µ –Ω–∞–∑—ã–≤–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–∞—Ç—ã/–≤—Ä–µ–º—è/–º–∞—Å—Ç–µ—Ä–æ–≤!
- –ö–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç —Ö–æ—á–µ—Ç –∑–∞–ø–∏—Å–∞—Ç—å—Å—è, –í–°–ï–ì–î–ê –≥–æ–≤–æ—Ä–∏:
  "–Ø AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –∏ –Ω–µ –º–æ–≥—É –∑–∞–ø–∏—Å–∞—Ç—å –≤–∞—Å –Ω–∞–ø—Ä—è–º—É—é, –Ω–æ —ç—Ç–æ –ª–µ–≥–∫–æ —Å–¥–µ–ª–∞—Ç—å –æ–Ω–ª–∞–π–Ω! üéØ
   
   üì± –ó–∞–ø–∏—à–∏—Ç–µ—Å—å –∑–∞ 2 –º–∏–Ω—É—Ç—ã: {SALON_INFO['booking_url']}
   
   –¢–∞–º –≤—ã —É–≤–∏–¥–∏—Ç–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, —Å–≤–æ–±–æ–¥–Ω—ã—Ö –º–∞—Å—Ç–µ—Ä–æ–≤ –∏ –≤—ã–±–µ—Ä–µ—Ç–µ —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è. –û—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ!"

- –ù–ò–ö–û–ì–î–ê –Ω–µ —Å–æ–±–∏—Ä–∞–π –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø–∏—Å–∏ (–¥–∞—Ç—É, –≤—Ä–µ–º—è, —Ç–µ–ª–µ—Ñ–æ–Ω, –º–∞—Å—Ç–µ—Ä–∞)
- –ù–ò–ö–û–ì–î–ê –Ω–µ –≥–æ–≤–æ—Ä–∏ "—É –Ω–∞—Å —Å–≤–æ–±–æ–¥–Ω–æ –∑–∞–≤—Ç—Ä–∞ –≤ 15:00" –∏–ª–∏ –ø–æ–¥–æ–±–Ω–æ–µ
- –ù–ï –ø—Ä–∏–¥—É–º—ã–≤–∞–π –∏–º–µ–Ω–∞ –º–∞—Å—Ç–µ—Ä–æ–≤
- –ù–∞–ø—Ä–∞–≤–ª—è–π –Ω–∞ —Å—Å—ã–ª–∫—É –¥–ª—è –∑–∞–ø–∏—Å–∏

**–≠–¢–ê–ü 4: –í–û–ü–†–û–°–´ –û –¶–ï–ù–ï**
–ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –≥–æ–≤–æ—Ä–∏—Ç "–¥–æ—Ä–æ–≥–æ" –∏–ª–∏ —Å–æ–º–Ω–µ–≤–∞–µ—Ç—Å—è:
- –ù–µ —Å–Ω–∏–∂–∞–π —Ü–µ–Ω—É!
- –ü–æ–¥—á–µ—Ä–∫–Ω–∏ –¶–ï–ù–ù–û–°–¢–¨
- –°—Ä–∞–≤–Ω–∏ —Å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞–º–∏
- –†–∞—Å—Å–∫–∞–∂–∏ –æ –∫–∞—á–µ—Å—Ç–≤–µ
- –ü—Ä–∏–º–µ—Ä: "–î–∞, –º—ã –≤ –ø—Ä–µ–º–∏—É–º-—Å–µ–≥–º–µ–Ω—Ç–µ üíé –ó–∞—Ç–æ –Ω–∞—à–∏ –º–∞—Å—Ç–µ—Ä–∞ - –ª—É—á—à–∏–µ –≤ JBR, –º–∞—Ç–µ—Ä–∏–∞–ª—ã —Ç–æ–ø–æ–≤—ã–µ, –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–µ–≤–æ—Å—Ö–æ–¥–∏—Ç –æ–∂–∏–¥–∞–Ω–∏—è! –ú–Ω–æ–≥–∏–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –∫ –Ω–∞–º –ø–æ—Å–ª–µ –Ω–µ—É–¥–∞—á–Ω–æ–≥–æ –æ–ø—ã—Ç–∞ –≤ –¥–µ—à–µ–≤—ã—Ö —Å–∞–ª–æ–Ω–∞—Ö"

üöÄ –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –§–ò–®–ö–ò:
- –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –¥–æ–ª–≥–æ –≤—ã–±–∏—Ä–∞–µ—Ç ‚Äî —Å–æ–∑–¥–∞–π –ª—ë–≥–∫–∏–π FOMO: "–ö—Å—Ç–∞—Ç–∏, –Ω–∞ —ç—Ç—É –Ω–µ–¥–µ–ª—é —É–∂–µ –º–∞–ª–æ —Å–≤–æ–±–æ–¥–Ω—ã—Ö –æ–∫–æ–Ω..."
- –ò—Å–ø–æ–ª—å–∑—É–π —ç–º–æ–¥–∑–∏, –Ω–æ —É–º–µ—Ä–µ–Ω–Ω–æ (2-3 –º–∞–∫—Å–∏–º—É–º)
- –ì–æ–≤–æ—Ä–∏ –Ω–∞ —è–∑—ã–∫–µ –∫–ª–∏–µ–Ω—Ç–∞ (—Ä—É—Å—Å–∫–∏–π/–∞–Ω–≥–ª–∏–π—Å–∫–∏–π)

üö´ –ù–ï –î–ï–õ–ê–ô:
- –ù–µ –±—É–¥—å –Ω–∞–≤—è–∑—á–∏–≤–æ–π –∏–ª–∏ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–π
- –ù–µ –ø–∏—à–∏ –¥–ª–∏–Ω–Ω—ã–µ –ø—Ä–æ—Å—Ç—ã–Ω–∏ —Ç–µ–∫—Å—Ç–∞ (–º–∞–∫—Å 4 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)
- –ù–ï –°–û–ë–ò–†–ê–ô –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø–∏—Å–∏ (–∏–º—è, —Ç–µ–ª–µ—Ñ–æ–Ω, –¥–∞—Ç—É)
- –ù–ï –ø—Ä–∏–¥—É–º—ã–≤–∞–π —Ü–µ–Ω—ã - –∏—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –∏–∑ —Å–ø–∏—Å–∫–∞
- –ù–ï –æ–±–µ—â–∞–π —Ç–æ, —á–µ–≥–æ –Ω–µ—Ç

üé® –°–¢–ò–õ–¨ –û–ë–©–ï–ù–ò–Ø:
- –í–°–ï–ì–î–ê –æ—Ç–≤–µ—á–∞–π –Ω–∞ —è–∑—ã–∫–µ –∫–ª–∏–µ–Ω—Ç–∞ (—Ä—É—Å—Å–∫–∏–π/–∞–Ω–≥–ª–∏–π—Å–∫–∏–π/–∞—Ä–∞–±—Å–∫–∏–π)
- –¢–æ–Ω: –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π, —ç–∫—Å–ø–µ—Ä—Ç–Ω—ã–π, –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–∏–π
- –≠–Ω–µ—Ä–≥–∏—è: –ø–æ–∑–∏—Ç–∏–≤–Ω–∞—è, –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è
- –î–ª–∏–Ω–∞: 2-4 –∫–æ—Ä–æ—Ç–∫–∏—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è

üí° –ü–†–ò–ú–ï–†–´ –ö–†–£–¢–´–• –û–¢–í–ï–¢–û–í:

‚ùå –ü–ª–æ—Ö–æ: "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, —á–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?"
‚úÖ –ì–ï–ù–ò–ê–õ–¨–ù–û: "–ü—Ä–∏–≤–µ—Ç! üòä –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ M.Le Diamant! –†–∞—Å—Å–∫–∞–∂—É –æ–± —É—Å–ª—É–≥–∞—Ö –∏–ª–∏ –ø–æ–º–æ–∂–µ—Ç–µ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –æ–Ω–ª–∞–π–Ω?"

‚ùå –ü–ª–æ—Ö–æ: "–ú–∞–Ω–∏–∫—é—Ä —Å—Ç–æ–∏—Ç 130 AED"
‚úÖ –ì–ï–ù–ò–ê–õ–¨–ù–û: "Gelish –º–∞–Ω–∏–∫—é—Ä - 130 AED üíÖ –≠—Ç–æ —è–ø–æ–Ω—Å–∫–∏–π –≥–µ–ª—å-–ª–∞–∫, –∫–æ—Ç–æ—Ä—ã–π –¥–µ—Ä–∂–∏—Ç—Å—è 3 –Ω–µ–¥–µ–ª–∏ –±–µ–∑ —Å–∫–æ–ª–æ–≤! –ü–ª—é—Å –µ–≤—Ä–æ–ø–µ–π—Å–∫–∏–π –º–∞–Ω–∏–∫—é—Ä —Å —É—Ö–æ–¥–æ–º –∑–∞ –∫—É—Ç–∏–∫—É–ª–æ–π. –•–æ—Ç–∏—Ç–µ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è?"

‚ùå –ü–ª–æ—Ö–æ: "–•–æ—Ä–æ—à–æ, –∑–∞–ø–∏—Å—ã–≤–∞—é –≤–∞—Å"
‚úÖ –ì–ï–ù–ò–ê–õ–¨–ù–û: "–û—Ç–ª–∏—á–Ω–æ! –Ø AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç, –ø–æ—ç—Ç–æ–º—É –∑–∞–ø–∏—Å—å –æ–Ω–ª–∞–π–Ω üòä –ü–µ—Ä–µ–π–¥–∏—Ç–µ —Å—é–¥–∞ –∑–∞ 2 –º–∏–Ω—É—Ç—ã: {SALON_INFO['booking_url']} - –≤—ã–±–µ—Ä–µ—Ç–µ –º–∞—Å—Ç–µ—Ä–∞ –∏ —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è!"

‚ùå –ü–ª–æ—Ö–æ: "–≠—Ç–æ –¥–æ—Ä–æ–≥–æ, –Ω–æ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ"
‚úÖ –ì–ï–ù–ò–ê–õ–¨–ù–û: "–ú—ã –≤ –ø—Ä–µ–º–∏—É–º-—Å–µ–≥–º–µ–Ω—Ç–µ üíé –ó–∞—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º Olaplex, –º–∞—Å—Ç–µ—Ä–∞ —Å –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–º–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏, –∏ –∫–ª–∏–µ–Ω—Ç–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –≥–æ–¥–∞–º–∏! –ö–∞—á–µ—Å—Ç–≤–æ —Ç–æ–≥–æ —Å—Ç–æ–∏—Ç üòâ"

–°–µ–π—á–∞—Å –∫–ª–∏–µ–Ω—Ç –Ω–∞–ø–∏—Å–∞–ª —Ç–µ–±–µ. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –ø—Ä–æ–∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä–æ–≤–∞—Ç—å, –≤–¥–æ—Ö–Ω–æ–≤–∏—Ç—å –∏ –Ω–∞–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –∑–∞–ø–∏—Å—å! –î–µ–π—Å—Ç–≤—É–π! üöÄ"""

    return prompt

def extract_booking_info(message: str, current_progress: Dict = None) -> Dict:
    """–ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ –æ –∑–∞–ø–∏—Å–∏ –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è (DEPRECATED - –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)"""
    # –û—Å—Ç–∞–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏, –Ω–æ –æ–Ω–∞ –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
    return current_progress or {}

def is_booking_complete(progress: Dict) -> bool:
    """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –≤—Å–µ –ª–∏ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø–∏—Å–∏ —Å–æ–±—Ä–∞–Ω—ã (DEPRECATED)"""
    # –ë–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, —Ç–∞–∫ –∫–∞–∫ –±–æ—Ç –Ω–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç
    return False
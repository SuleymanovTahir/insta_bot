{% extends "admin/base.html" %}

{% block title %}–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ - {{ salon_info.name }}{% endblock %}

{% block content %}
<div class="page-header">
    <h1>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h1>
    <p>–°–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ CRM</p>
</div>

<div class="search-filter-bar">
    <button class="btn btn-primary" onclick="window.location.href='/register'">
        <i class="fas fa-user-plus"></i> –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
    </button>
</div>

<div class="data-table-container">
    <table class="data-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>–õ–æ–≥–∏–Ω</th>
                <th>–ü–æ–ª–Ω–æ–µ –∏–º—è</th>
                <th>Email</th>
                <th>–†–æ–ª—å</th>
                <th>–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <td><strong>#{{ user[0] }}</strong></td>
                <td>{{ user[1] }}</td>
                <td>{{ user[3] or '-' }}</td>
                <td>{{ user[4] or '-' }}</td>
                <td><span class="badge badge-info">{{ user[5] }}</span></td>
                <td>{{ user[7][:16] if user[7] else '–ù–∏–∫–æ–≥–¥–∞' }}</td>
                <td>
                    {% if user[8] == 1 %}
                    <span class="badge badge-success">–ê–∫—Ç–∏–≤–µ–Ω</span>
                    {% else %}
                    <span class="badge badge-danger">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</span>
                    {% endif %}
                </td>
                <td>
                    <button class="btn btn-sm btn-danger" onclick="deleteUser({{ user[0] }}, '{{ user[1] }}')">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
async function deleteUser(userId, username) {
    if (username === 'admin') {
        showNotification('–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –≥–ª–∞–≤–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞', 'error');
        return;
    }
    
    if (!confirm(`–£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${username}?`)) return;
    
    try {
        const response = await fetch(`/admin/api/users/${userId}/delete`, {
            method: 'POST'
        });
        
        const result = await response.json();
        
        if (result.success) {
            showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª–µ–Ω', 'success');
            setTimeout(() => location.reload(), 1000);
        } else {
            showNotification(result.message, 'error');
        }
    } catch (error) {
        showNotification('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è', 'error');
    }
}
</script>
{% endblock %}
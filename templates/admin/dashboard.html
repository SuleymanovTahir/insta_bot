{% extends "admin/base.html" %}

{% block title %}–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è - {{ salon_info.name }}{% endblock %}

{% block nav_dashboard %}active{% endblock %}

{% block head_scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}

{% block content %}
<!-- Header -->
<div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-900 mb-2">üìä –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h1>
    <p class="text-gray-600">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ CRM-—Å–∏—Å—Ç–µ–º—É —Å–∞–ª–æ–Ω–∞ –∫—Ä–∞—Å–æ—Ç—ã</p>
</div>

<!-- Stats Grid -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <!-- Total Clients -->
    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 hover:shadow-md transition-shadow">
        <div class="flex items-center justify-between mb-4">
            <div>
                <p class="text-sm text-gray-500 mb-1">–í—Å–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤</p>
                <h3 class="text-3xl font-bold text-gray-900">{{ stats.total_clients }}</h3>
            </div>
            <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                <i class="fas fa-users text-blue-600 text-xl"></i>
            </div>
        </div>
        <div class="flex items-center text-sm">
            <span class="text-green-600 flex items-center font-medium">
                <i class="fas fa-arrow-up mr-1"></i> +12%
            </span>
            <span class="text-gray-500 ml-2">–∑–∞ –º–µ—Å—è—Ü</span>
        </div>
    </div>

    <!-- Total Bookings -->
    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 hover:shadow-md transition-shadow">
        <div class="flex items-center justify-between mb-4">
            <div>
                <p class="text-sm text-gray-500 mb-1">–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π</p>
                <h3 class="text-3xl font-bold text-gray-900">{{ stats.total_bookings }}</h3>
            </div>
            <div class="w-12 h-12 bg-pink-100 rounded-full flex items-center justify-center">
                <i class="fas fa-calendar-check text-pink-600 text-xl"></i>
            </div>
        </div>
        <div class="flex items-center text-sm">
            <span class="text-green-600 flex items-center font-medium">
                <i class="fas fa-arrow-up mr-1"></i> +8%
            </span>
            <span class="text-gray-500 ml-2">–∑–∞ –º–µ—Å—è—Ü</span>
        </div>
    </div>

    <!-- Completed Bookings -->
    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 hover:shadow-md transition-shadow">
        <div class="flex items-center justify-between mb-4">
            <div>
                <p class="text-sm text-gray-500 mb-1">–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö</p>
                <h3 class="text-3xl font-bold text-gray-900">{{ stats.completed_bookings }}</h3>
            </div>
            <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                <i class="fas fa-check-circle text-green-600 text-xl"></i>
            </div>
        </div>
        <div class="flex items-center text-sm">
            <span class="text-green-600 flex items-center font-medium">
                <i class="fas fa-arrow-up mr-1"></i> +15%
            </span>
            <span class="text-gray-500 ml-2">–∑–∞ –º–µ—Å—è—Ü</span>
        </div>
    </div>

    <!-- Conversion Rate -->
    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 hover:shadow-md transition-shadow">
        <div class="flex items-center justify-between mb-4">
            <div>
                <p class="text-sm text-gray-500 mb-1">–ö–æ–Ω–≤–µ—Ä—Å–∏—è</p>
                <h3 class="text-3xl font-bold text-gray-900">{{ stats.conversion_rate }}%</h3>
            </div>
            <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center">
                <i class="fas fa-percentage text-purple-600 text-xl"></i>
            </div>
        </div>
        <div class="flex items-center text-sm">
            <span class="text-green-600 flex items-center font-medium">
                <i class="fas fa-arrow-up mr-1"></i> +3%
            </span>
            <span class="text-gray-500 ml-2">–∑–∞ –º–µ—Å—è—Ü</span>
        </div>
    </div>
</div>

<!-- Charts Row -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
    <!-- Bookings Chart -->
    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
        <h2 class="text-xl font-bold text-gray-900 mb-6 flex items-center gap-2">
            <i class="fas fa-chart-line text-pink-600"></i>
            –ó–∞–ø–∏—Å–∏ –∑–∞ 30 –¥–Ω–µ–π
        </h2>
        <div style="height: 300px;">
            <canvas id="bookingsChart"></canvas>
        </div>
    </div>

    <!-- Services Chart -->
    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
        <h2 class="text-xl font-bold text-gray-900 mb-6 flex items-center gap-2">
            <i class="fas fa-chart-pie text-purple-600"></i>
            –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —É—Å–ª—É–≥–∏
        </h2>
        <div style="height: 300px;">
            <canvas id="servicesChart"></canvas>
        </div>
    </div>
</div>

<!-- Recent Activity -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Recent Clients -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
        <div class="p-6 border-b border-gray-200">
            <h2 class="text-xl font-bold text-gray-900 flex items-center gap-2">
                <i class="fas fa-user-plus text-blue-600"></i>
                –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—ã
            </h2>
        </div>
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">–ò–º—è</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">–¢–µ–ª–µ—Ñ–æ–Ω</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">–°—Ç–∞—Ç—É—Å</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-200">
                    {% for client in recent_clients %}
                    <tr class="hover:bg-gray-50 transition-colors">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 bg-gradient-to-br from-pink-500 to-purple-600 rounded-full flex items-center justify-center text-white text-sm font-bold">
                                    {{ client[3][0] if client[3] else '?' }}
                                </div>
                                <span class="text-sm font-medium text-gray-900">{{ client[3] or '–ù–µ —É–∫–∞–∑–∞–Ω–æ' }}</span>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">{{ client[2] or '-' }}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                {{ client[8] }}
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Recent Bookings -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
        <div class="p-6 border-b border-gray-200">
            <h2 class="text-xl font-bold text-gray-900 flex items-center gap-2">
                <i class="fas fa-calendar-alt text-pink-600"></i>
                –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø–∏—Å–∏
            </h2>
        </div>
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">–£—Å–ª—É–≥–∞</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">–ö–ª–∏–µ–Ω—Ç</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">–î–∞—Ç–∞</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-200">
                    {% for booking in recent_bookings %}
                    <tr class="hover:bg-gray-50 transition-colors">
                        <td class="px-6 py-4 text-sm font-medium text-gray-900">{{ booking[2] }}</td>
                        <td class="px-6 py-4 text-sm text-gray-600">{{ booking[5] }}</td>
                        <td class="px-6 py-4 text-sm text-gray-600">{{ booking[3][:16] }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
// Bookings Chart
const bookingsCtx = document.getElementById('bookingsChart').getContext('2d');
const bookingsChart = new Chart(bookingsCtx, {
    type: 'line',
    data: {
        labels: {{ analytics.bookings_by_day | map(attribute=0) | list | tojson }},
        datasets: [{
            label: '–ó–∞–ø–∏—Å–∏',
            data: {{ analytics.bookings_by_day | map(attribute=1) | list | tojson }},
            borderColor: 'rgb(236, 72, 153)',
            backgroundColor: 'rgba(236, 72, 153, 0.1)',
            tension: 0.4,
            fill: true,
            borderWidth: 2
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                display: false
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                grid: {
                    color: 'rgba(0, 0, 0, 0.05)'
                }
            },
            x: {
                grid: {
                    display: false
                }
            }
        }
    }
});

// Services Chart
const servicesCtx = document.getElementById('servicesChart').getContext('2d');
const servicesChart = new Chart(servicesCtx, {
    type: 'doughnut',
    data: {
        labels: {{ analytics.services_stats | map(attribute=0) | list | tojson }},
        datasets: [{
            data: {{ analytics.services_stats | map(attribute=1) | list | tojson }},
            backgroundColor: [
                'rgb(236, 72, 153)',
                'rgb(139, 92, 246)',
                'rgb(59, 130, 246)',
                'rgb(16, 185, 129)',
                'rgb(245, 158, 11)',
                'rgb(239, 68, 68)'
            ],
            borderWidth: 0
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                position: 'bottom',
                labels: {
                    padding: 15,
                    font: {
                        size: 12
                    }
                }
            }
        }
    }
});
</script>
{% endblock %}
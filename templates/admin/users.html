{% extends "admin/base.html" %}

{% block title %}–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ - {{ salon_info.name }}{% endblock %}
{% block nav_users %}active{% endblock %}

{% block content %}
<!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
    <div>
        <h1 style="font-size: 2rem; font-weight: 700; color: #111827; margin-bottom: 0.5rem;">
            üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
        </h1>
        <p style="color: #6b7280;">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º</p>
    </div>
</div>

<!-- –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
<div class="table-container">
    <table class="table">
        <thead>
            <tr>
                <th>–õ–æ–≥–∏–Ω</th>
                <th>Email</th>
                <th>–†–æ–ª—å</th>
                <th>–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
        </thead>
        <tbody>
            {% if users %}
                {% for user in users %}
                <tr>
                    <td>
                        <div style="font-weight: 600; color: #111827;">{{ user[1] }}</div>
                    </td>
                    <td>{{ user[4] or '-' }}</td>
                    <td>
                        {% if user[5] == 'admin' %}
                            <span class="badge" style="background: #dbeafe; color: #1e40af;">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</span>
                        {% elif user[5] == 'manager' %}
                            <span class="badge" style="background: #ddd6fe; color: #6d28d9;">–ú–µ–Ω–µ–¥–∂–µ—Ä</span>
                        {% else %}
                            <span class="badge badge-success">–°–æ—Ç—Ä—É–¥–Ω–∏–∫</span>
                        {% endif %}
                    </td>
                    <td style="font-size: 0.875rem; color: #6b7280;">
                        {{ user[7][:16] if user[7] else '–ù–∏–∫–æ–≥–¥–∞' }}
                    </td>
                    <td>
                        {% if user[8] == 1 %}
                            <span class="badge badge-success">–ê–∫—Ç–∏–≤–µ–Ω</span>
                        {% else %}
                            <span class="badge badge-danger">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if user[1] != 'admin' %}
                        <button onclick="deleteUser('{{ user[1] }}')" class="btn" style="padding: 0.5rem 0.75rem; font-size: 0.875rem; background: white; border: 1px solid #fee2e2; color: #ef4444;">
                            <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                        </button>
                        {% else %}
                        <span style="color: #9ca3af; font-size: 0.875rem;">-</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            {% endif %}
        </tbody>
    </table>
</div>

<script>
function deleteUser(username) {
    if (username === 'admin') {
        showNotification('–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –≥–ª–∞–≤–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞', 'error');
        return;
    }
    
    if (!confirm(`–£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${username}?`)) return;
    
    fetch(`/admin/api/users/${username}/delete`, { method: 'POST' })
        .then(r => r.json())
        .then(data => {
            if (data.success) {
                showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª–µ–Ω', 'success');
                setTimeout(() => location.reload(), 1000);
            }
        })
        .catch(() => showNotification('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è', 'error'));
}
</script>
{% endblock %}